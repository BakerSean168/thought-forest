---
tags:
  - tech/ops/git
  - type/howto
  - status/evergreen
description: Git撤销已推送的远程提交(git revert与force push)
created: 2025-01-01T00:00:00
updated: 2025-12-07T21:16:36
---

> [!info] **上级索引**
> [[Git MOC]] | [[Git命令速查]]

---


# 撤销远程分支的修改 

这是一个质的转变。一旦代码被推送到远程仓库（Push），这就不仅仅是你个人的事情了，而是涉及到**团队协作**和**历史一致性**的问题。

处理这种情况，你需要根据\*\*“有多少人可能已经拉取了你的代码”\*\*来选择策略。

-----

## 情境

`git push` 之后，你的提交已经进入了远程仓库（如 GitHub/GitLab）。你的队友可能已经把这些错误的代码 pull 到了他们的电脑上。

-----

## 方法

### 方式一：使用 `git revert` (推荐：安全、规范)

这是最标准、最安全的做法。它**不会删除**旧的提交记录，而是生成一个新的提交（Commit），这个新提交的内容是**把刚才错误的修改“反向”做一遍**。

  * **适用场景**：公共分支（如 `main`, `develop`），或者多人协作的分支。
  * **操作步骤**：

	1.  找到你想撤销的那次提交的 ID (Hash)。
	2.  执行：

		```bash
        git revert <Commit-ID>
        # 如果是撤销最近一次提交，直接用：
        git revert HEAD
        ```

	3.  Git 会弹出一个编辑器让你写提交信息（默认是 `Revert "原提交信息"`），保存退出即可。
	4.  推送到远程：

		```bash
        git push
        ```

  * **结果**：错误的代码被抵消了，历史记录里会多一条 Revert 记录。你的队友拉取代码时，不会遇到冲突，非常顺滑。

### 方式二：`git reset` + 强推 (慎用：暴力、彻底)

这种方法是**强行**把远程仓库的时间倒流。

  * **适用场景**：**只有你一个人在使用**的分支（个人 Feature 分支），且你**百分之百确定**没有队友拉取过你的代码。
  * **操作步骤**：

	1.  先在本地回退（和刚才讲的一样）：

		```bash
        # 回退到上一个版本，且不保留代码
        git reset --hard HEAD^
        ```

	2.  **强制推送**到远程（因为本地版本落后于远程，普通 push 会被拒绝，必须加 `-f`）：

		```bash
        git push origin <你的分支名> --force
        # 或者
        git push -f
        ```

  * **结果**：远程仓库的那条错误提交彻底消失了，就像从未发生过一样。
  * **⚠️ 严重警告**：如果在公共分支（如 main）上使用此招，**会造成灾难**。队友下次 pull 代码时会报错，甚至导致他们的本地代码丢失或冲突地狱。

-----

## 知识

### 1\. 为什么 `git revert` 更适合已 Push 的代码？

想象一下账本：

  * **`git reset`** 就像是用涂改液把写错的那一行**涂掉**。如果别人已经抄写了你的账本，你涂掉了，你们的账本就对不上了。
  * **`git revert`** 就像是在账本下一行写上一笔**红色的“冲账”**。虽然错的那笔还在，但加上冲账后，总数是对的。所有人的账本都能顺利接续。

### 2\. 什么是“破坏历史”？

Git 是分布式的。当你 Push 之后，那次 Commit 就存在于服务器和所有队友的电脑里。
如果你使用 `git reset --hard` 并强推，你实际上是**修改了历史**。

  * **如果队友已经 Pull 了**：他们的历史里有 Commit A，而你的新历史里 Commit A 不见了。当他们试图再次 Push 时，Git 会发现历史线断裂（Non-fast-forward），导致严重的冲突。

### 3\. 如何选择？

| 维度 | `git revert` | `git reset --hard` + `push -f` |
| :--- | :--- | :--- |
| **操作性质** | 新增一个“反向”提交 | 物理删除提交记录 |
| **历史记录** | 变长（保留了错误和修正） | 变短（完全抹去错误） |
| **安全性** | ✅ **极高** (队友无感) | ❌ **危险** (可能坑队友) |
| **适用分支** | **所有公共分支 (main/dev)** | **仅限个人私有分支** |

-----

**总结建议：**

除非你在自己的私有分支上自娱自乐，否则**永远优先使用 `git revert`**。

你现在是在公司的公共分支上，还是自己的分支上操作？这决定了你能不能用“后悔药”（Reset）。
