---
tags:
  - status/growing
  - tech/dev/frontend/eng
  - type/howto
description: å¤šå±‚çº§ï¼ˆmonorepoï¼‰é¡¹ç›®å¯ä¸å¯ä»¥åœ¨æ ¹ç›®å½•å¼•å…¥å¤šä¸ªå­é¡¹ç›®ä½¿ç”¨çš„ä¾èµ–ï¼Œç„¶åå­é¡¹ç›®å°±ä¸å¼•å…¥ï¼Œæ¥è¾¾åˆ°æ ¹ç›®å½•çš„packageç»Ÿä¸€ç®¡ç†çš„æ•ˆæœï¼Ÿ
created: 2025-01-01T00:00:00
updated: 2025-12-07T21:16:36
---

> [!info] **ä¸Šçº§ç´¢å¼•**
> [[Obsidian MOC]] | [[çŸ¥è¯†åº“ç®¡ç†ä½“ç³» MOC]]

---


# monorepoä¸­çš„ä¾èµ–ç®¡ç† 

é¦–å…ˆä¸ºäº†èŠ‚çœç©ºé—´æˆ–è€…è¯´å¤ç”¨ä¾èµ–ï¼Œå‡å°‘ä»£ç å’Œç»´æŠ¤ï¼Œä¼šæƒ³åˆ° å¯ä¸å¯ä»¥åœ¨æ ¹ç›®å½•å¼•å…¥å¤šä¸ªå­é¡¹ç›®ä½¿ç”¨çš„ä¾èµ–ï¼Œç„¶åå­é¡¹ç›®å°±ä¸ç”¨å¼•å…¥äº†ã€‚
- æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä»£ç èƒ½è·‘ã€‚
		Node.js çš„æ¨¡å—æŸ¥æ‰¾æœºåˆ¶æ˜¯é€’å½’å‘ä¸Šçš„ã€‚å½“ä½  `import X` æ—¶ï¼ŒNode ä¼šæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ï¼š
		1.  `./node_modules` (å½“å‰åŒ…)
		2.  `../node_modules` (ä¸Šä¸€çº§)
		3.  `../../node_modules` (æ ¹ç›®å½•)
		**è¿™æ„å‘³ç€ï¼š**
		å¦‚æœåœ¨æ ¹ç›®å½•å®‰è£…äº† `axios`ï¼Œå³ä½¿ `apps/web/package.json` é‡Œæ²¡å†™ `axios`ï¼Œä½ åœ¨ `apps/web/src/index.ts` é‡Œå†™ `import axios from 'axios'`ï¼Œ**ä»£ç æ˜¯å¯ä»¥è¿è¡Œçš„**ï¼ˆå› ä¸º Node ä¼šä¸€è·¯å‘ä¸Šæ‰¾åˆ°æ ¹ç›®å½•çš„ `node_modules`ï¼‰ã€‚

- å·¥ç¨‹å±‚é¢ï¼šéšå¼ä¾èµ–é™·é˜± (The Trap)
		è™½ç„¶ä¸Šé¢çš„â€œå†’æ³¡æŸ¥æ‰¾â€èƒ½è®©ä»£ç è·‘èµ·æ¥ï¼Œä½†è¿™åœ¨å·¥ç¨‹ä¸Šè¢«ç§°ä¸º **â€œå¹½çµä¾èµ–â€ (Phantom Dependency)** æˆ– **â€œéšå¼ä¾èµ–â€**ã€‚

**ç»“è®ºï¼šå¼ºçƒˆä¸å»ºè®®å¤ç”¨è¿è¡Œæ—¶ä¾èµ–ï¼ˆRuntime Depsï¼‰ã€‚**


**ä¸ºä»€ä¹ˆè¦ç¦æ­¢è¿™æ ·åšï¼Ÿ**

1.  **ç‰ˆæœ¬ä¸å¯æ§**ï¼š

      * å¦‚æœä½ åœ¨ `apps/web` é‡Œç”¨çš„æ˜¯æ ¹ç›®å½•çš„ `axios`ã€‚
      * æŸå¤©ä½ ä¸ºäº† `apps/api` çš„éœ€æ±‚ï¼Œå‡çº§äº†æ ¹ç›®å½•çš„ `axios`ï¼ˆæœ‰ç ´åæ€§æ›´æ–°ï¼‰ã€‚
      * **åæœ**ï¼š`apps/web` è«åå…¶å¦™æŒ‚äº†ï¼Œå› ä¸ºä½ æ ¹æœ¬ä¸çŸ¥é“å®ƒä¾èµ–äº†æ ¹ç›®å½•çš„ç‰ˆæœ¬ã€‚

2.  **ç ´åå¯ç§»æ¤æ€§**ï¼š

      * å¦‚æœä½ æƒ³æŠŠ `apps/web` æ‹†åˆ†å‡ºæ¥å•ç‹¬éƒ¨ç½²ï¼Œæˆ–è€…ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä»“åº“ã€‚
      * å› ä¸ºå®ƒçš„ `package.json` é‡Œæ²¡æœ‰å£°æ˜ `axios`ï¼Œä¸€æ—¦è„±ç¦»äº†è¿™ä¸ª Monorepo ç¯å¢ƒï¼Œå®ƒå°±è·‘ä¸èµ·æ¥äº†ã€‚

3.  **pnpm çš„ä¸¥æ ¼æ¨¡å¼**ï¼š

      * é»˜è®¤æƒ…å†µä¸‹ï¼Œ`pnpm` è¯•å›¾é˜»æ­¢ä½ è®¿é—®æœªå£°æ˜çš„ä¾èµ–ã€‚è™½ç„¶ Node.js å…è®¸å‘ä¸ŠæŸ¥æ‰¾ï¼Œä½† `pnpm` çš„ `node_modules` ç»“æ„è®¾è®¡å°±æ˜¯ä¸ºäº†è®©è¿™ç§â€œéæ³•è®¿é—®â€å˜å¾—å›°éš¾ï¼ˆå°½ç®¡åœ¨æ ¹ç›®å½•çš„ä¾èµ–é€šå¸¸è¿˜æ˜¯èƒ½è¢«è®¿é—®åˆ°çš„ï¼Œä½†è¿™å±äºâ€œæ¼ç½‘ä¹‹é±¼â€è€Œéç‰¹æ€§ï¼‰ã€‚

-----

### âœ… æœ€ä½³å®è·µç­–ç•¥ï¼šè¯¥æ€ä¹ˆæ”¾ï¼Ÿ

åœ¨ Monorepo ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éµå¾ª **"å·¥å…·å½’æ ¹ï¼Œåº”ç”¨å½’ç§"** çš„åŸåˆ™ã€‚

#### A. æ”¾åœ¨æ ¹ç›®å½• (Root) çš„ä¾èµ– ğŸŒ³

> **é€‚åˆï¼šå¼€å‘å·¥å…·ã€æ„å»ºå·¥å…·ã€è§„èŒƒç±»åº“**

è¿™äº›ä¾èµ–é€šå¸¸æ˜¯æ•´ä¸ªä»“åº“é€šç”¨çš„ï¼Œä¸éœ€è¦æ‰“è¿›ç”Ÿäº§ç¯å¢ƒåŒ…é‡Œã€‚

  * **ä¾‹å­**ï¼š
      * `typescript` (ä¿è¯å…¨ä»“åº“è¯­è¨€æ ‡å‡†ä¸€è‡´)
      * `eslint`, `prettier` (ä»£ç é£æ ¼ä¸€è‡´)
      * `husky`, `lint-staged` (Git é’©å­)
      * `@types/node` (åŸºç¡€ç±»å‹å®šä¹‰ï¼Œå¦‚å‰æ–‡è®¨è®º)
      * `turbo`, `nx` (æ„å»ºç¼–æ’å·¥å…·)

#### B. æ”¾åœ¨å­é¡¹ç›® (Package) çš„ä¾èµ– ğŸ“¦

> **é€‚åˆï¼šè¿è¡Œæ—¶ä¾èµ–ã€UI æ¡†æ¶ã€ç‰¹å®šä¸šåŠ¡åº“**

è¿™äº›ä¾èµ–ç›´æ¥å½±å“ä»£ç çš„è¿è¡Œé€»è¾‘ï¼Œå¿…é¡»åœ¨å„è‡ªçš„ `package.json` ä¸­æ˜ç¡®å£°æ˜ã€‚

  * **ä¾‹å­**ï¼š
      * `react`, `vue` (å‰ç«¯æ¡†æ¶)
      * `nestjs`, `express` (åç«¯æ¡†æ¶)
      * `lodash`, `axios`, `dayjs` (å·¥å…·åº“)
      * å†…éƒ¨ UI åº“ (å¦‚ `@my-org/ui`)

#### C. å¦‚ä½•é«˜æ•ˆæ“ä½œï¼Ÿ

ä½ ä¸éœ€è¦æ‰‹åŠ¨å»æ”¹æ¯ä¸ª json æ–‡ä»¶ï¼Œä½¿ç”¨ pnpm è¿‡æ»¤å™¨å‘½ä»¤ï¼š

  * **ç»™æ‰€æœ‰åŒ…å®‰è£… lodash** (ä¸æ¨èï¼Œé™¤éçœŸçš„éƒ½è¦ç”¨):

    ```bash
    pnpm add lodash -r  # -r è¡¨ç¤º recursive (é€’å½’æ‰€æœ‰åŒ…)
    ```

  * **åªç»™ api é¡¹ç›®å®‰è£… nestjs**:

    ```bash
    pnpm --filter api add @nestjs/core
    ```

  * **åœ¨æ ¹ç›®å½•å®‰è£… eslint (å¼€å‘ä¾èµ–)**:

    ```bash
    pnpm add -w -D eslint # -w è¡¨ç¤º workspace-root (ä»…æ ¹ç›®å½•)
    ```

### æ€»ç»“

  * **çœç©ºé—´å—ï¼Ÿ** çœï¼Œpnpm ä¼šè‡ªåŠ¨å»é‡ã€‚
  * **èƒ½ç›´æ¥ç”¨å—ï¼Ÿ** æ ¹ç›®å½•çš„åŒ…èƒ½è¢«å­é¡¹ç›®é€šè¿‡ `import` è¯»å–åˆ°ã€‚
  * **åº”è¯¥ç›´æ¥ç”¨å—ï¼Ÿ**
      * å¦‚æœæ˜¯ **å¼€å‘å·¥å…· (DevDeps)** -\> **æ˜¯**ï¼Œæ”¾æ ¹ç›®å½•å¤§å®¶ä¸€èµ·ç”¨ã€‚
      * å¦‚æœæ˜¯ **ç”Ÿäº§ä¾èµ– (Deps)** -\> **å¦**ï¼Œè¯·åœ¨æ¯ä¸ªå­é¡¹ç›®ä¸­æ˜¾å¼å®‰è£…ï¼Œå“ªæ€•ç‰ˆæœ¬å·ä¸€æ ·ã€‚è¿™å«â€œæ˜¾å¼ä¾èµ–â€ï¼Œæ˜¯å¥å£®å·¥ç¨‹çš„åŸºçŸ³ã€‚

|**ç±»åˆ«**|**æè¿°**|**æ”¾ç½®ä½ç½®**|**å…¸å‹ä¾‹å­**|
|---|---|---|---|
|**åŸºå»ºå·¥å…·**<br><br>  <br><br>(Infrastructure)|åªæ˜¯åœ¨å¼€å‘ã€æ„å»ºã€æµ‹è¯•é˜¶æ®µç”¨åˆ°ï¼Œ**ä¸ä¼šè¢«æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©**é‡Œã€‚|**æ ¹ç›®å½•**<br><br>  <br><br>(workspace root)|`typescript`<br><br>  <br><br>`eslint` ç›¸å…³å…¨å®¶æ¡¶<br><br>  <br><br>`prettier`<br><br>  <br><br>`husky` / `lint-staged`<br><br>  <br><br>`vitest` / `jest`<br><br>  <br><br>`turbo` / `nx`|
|**å…±äº«é…ç½®**<br><br>  <br><br>(Shared Config)|å…¨å±€é€šç”¨çš„é…ç½®æ–‡ä»¶ã€‚|**æ ¹ç›®å½•**|`@types/node`<br><br>  <br><br>`@tsconfig/node-lts`|
|**ä¸šåŠ¡ä¾èµ–**<br><br>  <br><br>(App Logic)|ä»£ç è¿è¡Œæ—¶ç¡®å®éœ€è¦å®ƒï¼Œ**ä¼šè¢«æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©** (bundle)ã€‚|**å„å­é¡¹ç›®**<br><br>  <br><br>(packages/apps)|`react` / `vue`<br><br>  <br><br>`@nestjs/core`<br><br>  <br><br>`axios`<br><br>  <br><br>`lodash`<br><br>  <br><br>`antd` / `element-plus`|
|**ç‰¹æ®Šå·¥å…·**<br><br>  <br><br>(Specific Tools)|åªæœ‰è¿™ä¸€ä¸ªå­é¡¹ç›®ç‰¹æœ‰çš„æ„å»ºéœ€æ±‚ï¼Œåˆ«çš„é¡¹ç›®å®Œå…¨ç”¨ä¸ä¸Šã€‚|**å„å­é¡¹ç›®**|æ¯”å¦‚ electron åªåœ¨ desktop ç”¨ï¼š<br><br>  <br><br>`electron`<br><br>  <br><br>`electron-builder`|