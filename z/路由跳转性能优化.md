---
tags:
  - tech/dev/frame
  - type/howto
  - status/growing
description: Vue Routerè·¯ç”±åŠ è½½æ€§èƒ½ä¼˜åŒ–æŒ‡å—
created: 2025-01-01T00:00:00
updated: 2025-12-07T21:16:36
---

> [!info] **ä¸Šçº§ç´¢å¼•**
> [[Vue3 MOC]] | [[å‰ç«¯æ€§èƒ½ä¼˜åŒ– MOC]]

---


# è·¯ç”±åŠ è½½æ€§èƒ½ä¼˜åŒ–æŒ‡å—

> æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» DailyUse Web åº”ç”¨ä¸­å®ç°çš„è·¯ç”±åŠ è½½æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œé€‚åˆå‰ç«¯å¼€å‘æ–°æ‰‹é˜…è¯»ã€‚

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
2. [ä¼˜åŒ–æ–¹æ¡ˆæ¦‚è§ˆ](#ä¼˜åŒ–æ–¹æ¡ˆæ¦‚è§ˆ)
3. [æ ¸å¿ƒä¼˜åŒ–ä¸€ï¼šè·¯ç”±éª¨æ¶å±](#æ ¸å¿ƒä¼˜åŒ–ä¸€è·¯ç”±éª¨æ¶å±)
4. [æ ¸å¿ƒä¼˜åŒ–äºŒï¼šHover é¢„åŠ è½½](#æ ¸å¿ƒä¼˜åŒ–äºŒhover-é¢„åŠ è½½)
5. [æ ¸å¿ƒä¼˜åŒ–ä¸‰ï¼šService Worker ç¼“å­˜](#æ ¸å¿ƒä¼˜åŒ–ä¸‰service-worker-ç¼“å­˜)
6. [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)
7. [å·¥ä½œæµç¨‹å›¾è§£](#å·¥ä½œæµç¨‹å›¾è§£)
8. [å¦‚ä½•æµ‹è¯•ä¼˜åŒ–æ•ˆæœ](#å¦‚ä½•æµ‹è¯•ä¼˜åŒ–æ•ˆæœ)
9. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é—®é¢˜èƒŒæ™¯

### ä¼˜åŒ–å‰çš„ç”¨æˆ·ä½“éªŒé—®é¢˜

åœ¨ SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ä¸­ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¯¼èˆªæŒ‰é’®åˆ‡æ¢é¡µé¢æ—¶ï¼Œä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

```
ç”¨æˆ·ç‚¹å‡»å¯¼èˆª â†’ [ç™½å±ç­‰å¾… 1-3 ç§’] â†’ é¡µé¢çªç„¶å‡ºç°
```

**ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ**

Vue Router ä½¿ç”¨**æ‡’åŠ è½½**ï¼ˆLazy Loadingï¼‰æ¥åˆ†å‰²ä»£ç ï¼š

```typescript
// è·¯ç”±é…ç½®ä¸­çš„æ‡’åŠ è½½å†™æ³•
component: () => import('../views/TaskManagementView.vue')
```

è¿™æ„å‘³ç€ï¼š
- é¡µé¢ç»„ä»¶çš„ JavaScript ä»£ç **ä¸ä¼š**åœ¨é¦–å±åŠ è½½
- åªæœ‰å½“ç”¨æˆ·è®¿é—®è¯¥è·¯ç”±æ—¶ï¼Œæ‰ä¼š**ä¸‹è½½**å¯¹åº”çš„ JS æ–‡ä»¶ï¼ˆchunkï¼‰
- ä¸‹è½½å’Œè§£ææœŸé—´ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°**ç™½å±æˆ–å¡é¡¿**

### ç”¨æˆ·å¿ƒç†å½±å“

ç ”ç©¶è¡¨æ˜ï¼š
- è¶…è¿‡ **100ms** çš„å»¶è¿Ÿï¼Œç”¨æˆ·å¼€å§‹æ„ŸçŸ¥åˆ°"ä¸æµç•…"
- è¶…è¿‡ **1 ç§’**çš„æ— åé¦ˆå»¶è¿Ÿï¼Œç”¨æˆ·ä¼šç„¦è™‘ï¼š*"æŒ‰é’®æŒ‰ä¸‹å»äº†å—ï¼Ÿæ˜¯ä¸æ˜¯å¡ä½äº†ï¼Ÿ"*

---

## ä¼˜åŒ–æ–¹æ¡ˆæ¦‚è§ˆ

æˆ‘ä»¬å®ç°äº†ä¸‰å±‚ä¼˜åŒ–ç­–ç•¥ï¼š

| ä¼˜åŒ–å±‚çº§ | æŠ€æœ¯æ–¹æ¡ˆ | è§£å†³çš„é—®é¢˜ |
|---------|---------|-----------|
| **å³æ—¶åé¦ˆ** | è·¯ç”±éª¨æ¶å± | ç‚¹å‡»åç«‹å³æ˜¾ç¤ºåŠ è½½çŠ¶æ€ |
| **æå‰åŠ è½½** | Hover é¢„åŠ è½½ | é¼ æ ‡æ‚¬åœæ—¶å°±å¼€å§‹åŠ è½½ |
| **ç¼“å­˜å¤ç”¨** | Service Worker | äºŒæ¬¡è®¿é—®ç§’å¼€ |

**ä¼˜åŒ–åçš„ç”¨æˆ·ä½“éªŒï¼š**

```
ç”¨æˆ·ç‚¹å‡»å¯¼èˆª â†’ ç«‹å³æ˜¾ç¤ºéª¨æ¶å± â†’ å†…å®¹æ¸å…¥ âœ¨
```

---

## æ ¸å¿ƒä¼˜åŒ–ä¸€ï¼šè·¯ç”±éª¨æ¶å±

### ä»€ä¹ˆæ˜¯éª¨æ¶å±ï¼Ÿ

éª¨æ¶å±ï¼ˆSkeleton Screenï¼‰æ˜¯ä¸€ç§**å ä½ç¬¦ UI**ï¼Œåœ¨å†…å®¹åŠ è½½å®Œæˆå‰æ˜¾ç¤ºé¡µé¢çš„å¤§è‡´ç»“æ„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â”‚  â† æ¨¡æ‹Ÿæ ‡é¢˜
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ     â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ     â”‚       â”‚  â† æ¨¡æ‹Ÿå¡ç‰‡
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚       â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ     â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°åŸç†

#### 1. åˆ›å»ºåŠ è½½çŠ¶æ€ Store

**æ–‡ä»¶ï¼š** `src/shared/stores/routeLoadingStore.ts`

```typescript
import { defineStore } from 'pinia';
import { ref } from 'vue';

export const useRouteLoadingStore = defineStore('routeLoading', () => {
  // æ˜¯å¦æ­£åœ¨åŠ è½½è·¯ç”±
  const isLoading = ref(false);
  
  // å¼€å§‹åŠ è½½
  const startLoading = (path: string) => {
    isLoading.value = true;
  };

  // ç»“æŸåŠ è½½
  const finishLoading = () => {
    isLoading.value = false;
  };

  return { isLoading, startLoading, finishLoading };
});
```

**ä¸ºä»€ä¹ˆç”¨ Pinia Storeï¼Ÿ**
- è·¯ç”±å®ˆå«å’Œç»„ä»¶éœ€è¦å…±äº«åŠ è½½çŠ¶æ€
- Store æ˜¯ Vue ä¸­è·¨ç»„ä»¶å…±äº«çŠ¶æ€çš„æ ‡å‡†æ–¹å¼

#### 2. åœ¨è·¯ç”±å®ˆå«ä¸­æ§åˆ¶åŠ è½½çŠ¶æ€

**æ–‡ä»¶ï¼š** `src/shared/router/guards.ts`

```typescript
// è·¯ç”±è·³è½¬å‰ï¼šæ˜¾ç¤ºéª¨æ¶å±
router.beforeEach(async (to, from, next) => {
  // åªåœ¨ä¸»åº”ç”¨å†…å¯¼èˆªæ—¶æ˜¾ç¤ºéª¨æ¶å±
  if (from.path !== to.path) {
    const { useRouteLoadingStore } = await import('../stores/routeLoadingStore');
    const routeLoadingStore = useRouteLoadingStore();
    routeLoadingStore.startLoading(to.path);  // â† ç«‹å³æ˜¾ç¤ºéª¨æ¶å±
  }
  // ... å…¶ä»–å®ˆå«é€»è¾‘
  next();
});

// è·¯ç”±è·³è½¬åï¼šéšè—éª¨æ¶å±
router.afterEach(async (to) => {
  const { useRouteLoadingStore } = await import('../stores/routeLoadingStore');
  const routeLoadingStore = useRouteLoadingStore();
  setTimeout(() => {
    routeLoadingStore.finishLoading();  // â† éšè—éª¨æ¶å±
  }, 50);  // å¾®å°å»¶è¿Ÿé¿å…é—ªçƒ
});
```

**å…³é”®ç‚¹ï¼š**
- `beforeEach` åœ¨è·¯ç”±ç»„ä»¶åŠ è½½**ä¹‹å‰**è§¦å‘ â†’ ç«‹å³æ˜¾ç¤ºéª¨æ¶å±
- `afterEach` åœ¨è·¯ç”±ç»„ä»¶åŠ è½½**ä¹‹å**è§¦å‘ â†’ éšè—éª¨æ¶å±

#### 3. åœ¨å¸ƒå±€ç»„ä»¶ä¸­æ˜¾ç¤ºéª¨æ¶å±

**æ–‡ä»¶ï¼š** `src/modules/app/MainLayout.vue`

```vue
<template>
  <v-app>
    <div class="app-layout">
      <div class="sidebar">
        <sidebar />
      </div>
      <div class="content">
        <v-main class="main-content">
          <!-- éª¨æ¶å±è¦†ç›–å±‚ -->
          <PageSkeleton v-if="isRouteLoading" class="page-skeleton-overlay" />
          
          <!-- è·¯ç”±è§†å›¾ -->
          <router-view v-slot="{ Component, route }">
            <div class="route-wrapper" :key="route.path">
              <component :is="Component" />
            </div>
          </router-view>
        </v-main>
      </div>
    </div>
  </v-app>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { storeToRefs } from 'pinia';
import PageSkeleton from '@/shared/components/PageSkeleton.vue';
import { useRouteLoadingStore } from '@/shared/stores/routeLoadingStore';

const routeLoadingStore = useRouteLoadingStore();
const { isLoading } = storeToRefs(routeLoadingStore);
const isRouteLoading = computed(() => isLoading.value);
</script>

<style scoped>
/* éª¨æ¶å±ä½œä¸ºè¦†ç›–å±‚ */
.page-skeleton-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10;
}
</style>
```

**ä¸ºä»€ä¹ˆç”¨è¦†ç›–å±‚è€Œä¸æ˜¯æ¡ä»¶æ¸²æŸ“ï¼Ÿ**

```vue
<!-- âŒ ä¸æ¨èï¼šæ¡ä»¶æ¸²æŸ“ -->
<PageSkeleton v-if="isLoading" />
<router-view v-else />

<!-- âœ… æ¨èï¼šè¦†ç›–å±‚ -->
<PageSkeleton v-if="isLoading" class="overlay" />
<router-view />  <!-- å§‹ç»ˆæ¸²æŸ“ -->
```

åŸå› ï¼š
- è¦†ç›–å±‚æ–¹å¼ä¸‹ï¼Œè·¯ç”±ç»„ä»¶åœ¨åå°**åŒæ—¶åŠ è½½**
- é¿å…äº†æ¡ä»¶åˆ‡æ¢æ—¶çš„ DOM é‡å»ºå¼€é”€

---

## æ ¸å¿ƒä¼˜åŒ–äºŒï¼šHover é¢„åŠ è½½

### ä»€ä¹ˆæ˜¯ Hover é¢„åŠ è½½ï¼Ÿ

å½“ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨å¯¼èˆªé“¾æ¥ä¸Šæ—¶ï¼Œæå‰åŠ è½½ç›®æ ‡é¡µé¢çš„ JS ä»£ç ã€‚

```
é¼ æ ‡æ‚¬åœ â†’ 150ms åå¼€å§‹é¢„åŠ è½½ â†’ ç”¨æˆ·ç‚¹å‡»æ—¶å·²åŠ è½½å®Œæˆ â†’ ç§’åˆ‡ï¼
```

### å®ç°åŸç†

**æ–‡ä»¶ï¼š** `src/shared/services/RoutePrefetchService.ts`

```typescript
// å·²é¢„åŠ è½½çš„è·¯ç”±é›†åˆï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
const prefetchedRoutes = new Set<string>();

// æ‚¬åœå®šæ—¶å™¨
let hoverTimer: ReturnType<typeof setTimeout> | null = null;

// è·¯ç”±åˆ°æ¨¡å—çš„æ˜ å°„
const routeModuleMap: Record<string, () => Promise<any>> = {
  '/': () => import('@/modules/dashboard/presentation/views/DashboardView.vue'),
  '/tasks': () => import('@/modules/task/presentation/views/TaskManagementView.vue'),
  '/goals': () => import('@/modules/goal/presentation/views/GoalListView.vue'),
  // ... å…¶ä»–è·¯ç”±
};

/**
 * é¢„åŠ è½½æŒ‡å®šè·¯ç”±çš„æ¨¡å—
 */
const prefetchRoute = async (path: string): Promise<void> => {
  // å·²ç»é¢„åŠ è½½è¿‡ï¼Œè·³è¿‡
  if (prefetchedRoutes.has(path)) {
    return;
  }

  const loader = routeModuleMap[path];
  
  if (loader) {
    console.log(`ğŸ”® [Prefetch] é¢„åŠ è½½è·¯ç”±: ${path}`);
    prefetchedRoutes.add(path);
    
    // åœ¨æµè§ˆå™¨ç©ºé—²æ—¶åŠ è½½
    if ('requestIdleCallback' in window) {
      requestIdleCallback(() => {
        loader();  // æ‰§è¡Œ import()ï¼Œè§¦å‘ä¸‹è½½
      }, { timeout: 2000 });
    } else {
      setTimeout(() => loader(), 100);
    }
  }
};

/**
 * é¼ æ ‡è¿›å…¥å¯¼èˆªé¡¹æ—¶è°ƒç”¨
 */
export const handleNavMouseEnter = (path: string): void => {
  // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
  if (hoverTimer) clearTimeout(hoverTimer);

  // 150ms å»¶è¿Ÿï¼Œé¿å…å¿«é€Ÿåˆ’è¿‡è§¦å‘
  hoverTimer = setTimeout(() => {
    prefetchRoute(path);
  }, 150);
};

/**
 * é¼ æ ‡ç¦»å¼€å¯¼èˆªé¡¹æ—¶è°ƒç”¨
 */
export const handleNavMouseLeave = (): void => {
  if (hoverTimer) {
    clearTimeout(hoverTimer);
    hoverTimer = null;
  }
};
```

### åœ¨å¯¼èˆªç»„ä»¶ä¸­ä½¿ç”¨

**æ–‡ä»¶ï¼š** `src/modules/app/components/Sidebar.vue`

```vue
<template>
  <button
    v-for="item in navigationItems"
    :key="item.name"
    @click="navigateTo(item.path)"
    @mouseenter="handleMouseEnter(item.path)"  <!-- é¼ æ ‡è¿›å…¥ -->
    @mouseleave="handleMouseLeave"              <!-- é¼ æ ‡ç¦»å¼€ -->
  >
    <v-icon :icon="item.icon" />
  </button>
</template>

<script setup lang="ts">
import { handleNavMouseEnter, handleNavMouseLeave } from '@/shared/services/RoutePrefetchService';

const handleMouseEnter = (path: string) => {
  if (!isActiveRoute(path)) {  // ä¸é¢„åŠ è½½å½“å‰é¡µé¢
    handleNavMouseEnter(path);
  }
};

const handleMouseLeave = () => {
  handleNavMouseLeave();
};
</script>
```

### ä¸ºä»€ä¹ˆè¦ 150ms å»¶è¿Ÿï¼Ÿ

```
ç”¨æˆ·å¿«é€Ÿåˆ’è¿‡å¤šä¸ªå¯¼èˆªé¡¹ â†’ ä¸è§¦å‘é¢„åŠ è½½ï¼ˆèŠ‚çœå¸¦å®½ï¼‰
ç”¨æˆ·åœ¨æŸé¡¹ä¸Šåœç•™ 150ms â†’ å¼€å§‹é¢„åŠ è½½ï¼ˆç”¨æˆ·å¯èƒ½è¦ç‚¹å‡»ï¼‰
```

### ä¸ºä»€ä¹ˆç”¨ requestIdleCallbackï¼Ÿ

```javascript
// requestIdleCallback åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œ
// ä¸ä¼šé˜»å¡ç”¨æˆ·äº¤äº’å’Œæ¸²æŸ“
requestIdleCallback(() => {
  loader();
}, { timeout: 2000 });  // æœ€å¤šç­‰ 2 ç§’
```

---

## æ ¸å¿ƒä¼˜åŒ–ä¸‰ï¼šService Worker ç¼“å­˜

### ä»€ä¹ˆæ˜¯ Service Workerï¼Ÿ

Service Worker æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨åå°çš„**ç‹¬ç«‹è„šæœ¬**ï¼Œå¯ä»¥ï¼š
- æ‹¦æˆªç½‘ç»œè¯·æ±‚
- ç¼“å­˜é™æ€èµ„æº
- å®ç°ç¦»çº¿è®¿é—®

### ç¼“å­˜ç­–ç•¥

| èµ„æºç±»å‹ | ç­–ç•¥ | è¯´æ˜ |
|---------|------|------|
| JS/CSS | Cache First | ä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼Œåå°æ›´æ–° |
| å­—ä½“/å›¾ç‰‡ | Cache First | é™æ€èµ„æºé•¿æœŸç¼“å­˜ |
| HTML | Network First | ç¡®ä¿è·å–æœ€æ–°ç‰ˆæœ¬ |
| API è¯·æ±‚ | ä¸ç¼“å­˜ | ä¿è¯æ•°æ®å®æ—¶æ€§ |

### å®ç°åŸç†

**æ–‡ä»¶ï¼š** `public/sw.js`ï¼ˆå¿…é¡»æ”¾åœ¨ public ç›®å½•ï¼‰

```javascript
const STATIC_CACHE_NAME = 'dailyuse-static-v1';

// é™æ€èµ„æºåŒ¹é…æ¨¡å¼
const STATIC_PATTERNS = [/\.js$/, /\.css$/, /\.woff2?$/, /\.png$/];

// ä¸ç¼“å­˜çš„æ¨¡å¼
const NO_CACHE_PATTERNS = [/\/api\//, /\/sse\//];

/**
 * Cache First ç­–ç•¥
 */
async function cacheFirst(request) {
  // 1. å…ˆæŸ¥ç¼“å­˜
  const cachedResponse = await caches.match(request);
  
  if (cachedResponse) {
    // 2. ç¼“å­˜å‘½ä¸­ï¼Œåå°æ›´æ–°
    fetch(request).then(response => {
      if (response.ok) {
        caches.open(STATIC_CACHE_NAME)
          .then(cache => cache.put(request, response));
      }
    });
    return cachedResponse;  // ç«‹å³è¿”å›ç¼“å­˜
  }
  
  // 3. ç¼“å­˜æœªå‘½ä¸­ï¼Œä»ç½‘ç»œè·å–å¹¶ç¼“å­˜
  const networkResponse = await fetch(request);
  if (networkResponse.ok) {
    const cache = await caches.open(STATIC_CACHE_NAME);
    cache.put(request, networkResponse.clone());
  }
  return networkResponse;
}

// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
self.addEventListener('fetch', (event) => {
  const url = event.request.url;
  
  // è·³è¿‡ä¸ç¼“å­˜çš„è¯·æ±‚
  if (NO_CACHE_PATTERNS.some(p => p.test(url))) return;
  
  // é™æ€èµ„æºä½¿ç”¨ Cache First
  if (STATIC_PATTERNS.some(p => p.test(url))) {
    event.respondWith(cacheFirst(event.request));
  }
});
```

### æ³¨å†Œ Service Worker

**æ–‡ä»¶ï¼š** `src/shared/services/ServiceWorkerService.ts`

```typescript
export const registerServiceWorker = async () => {
  // ä»…ç”Ÿäº§ç¯å¢ƒå¯ç”¨
  if (import.meta.env.DEV) {
    console.log('ğŸ”§ [SW] å¼€å‘ç¯å¢ƒè·³è¿‡æ³¨å†Œ');
    return null;
  }

  const registration = await navigator.serviceWorker.register('/sw.js');
  console.log('âœ… [SW] æ³¨å†ŒæˆåŠŸ');
  return registration;
};
```

**åœ¨ main.ts ä¸­è°ƒç”¨ï¼š**

```typescript
// ç”Ÿäº§ç¯å¢ƒæ³¨å†Œ Service Worker
if (import.meta.env.PROD) {
  import('./shared/services/ServiceWorkerService').then(({ registerServiceWorker }) => {
    registerServiceWorker();
  });
}
```

---

## æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ PageSkeleton.vue          # éª¨æ¶å±ç»„ä»¶
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ routeLoadingStore.ts      # åŠ è½½çŠ¶æ€ Store
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ RoutePrefetchService.ts   # Hover é¢„åŠ è½½æœåŠ¡
â”‚   â”‚   â””â”€â”€ ServiceWorkerService.ts   # SW æ³¨å†ŒæœåŠ¡
â”‚   â””â”€â”€ router/
â”‚       â””â”€â”€ guards.ts                  # è·¯ç”±å®ˆå«ï¼ˆæ§åˆ¶éª¨æ¶å±ï¼‰
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ MainLayout.vue            # ä¸»å¸ƒå±€ï¼ˆæ˜¾ç¤ºéª¨æ¶å±ï¼‰
â””â”€â”€ main.ts                           # æ³¨å†Œ Service Worker

public/
â””â”€â”€ sw.js                             # Service Workerï¼ˆçº¯ JSï¼‰
```

---

## å·¥ä½œæµç¨‹å›¾è§£

### é¦–æ¬¡è®¿é—®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       é¦–æ¬¡è®¿é—®æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. ç”¨æˆ·è®¿é—® /tasks                                         â”‚
â”‚     â†“                                                       â”‚
â”‚  2. beforeEach è§¦å‘ â†’ isLoading = true                     â”‚
â”‚     â†“                                                       â”‚
â”‚  3. æ˜¾ç¤ºéª¨æ¶å±ï¼ˆç«‹å³åé¦ˆï¼‰                                   â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Vue Router ä¸‹è½½ TaskManagementView.vue çš„ chunk        â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Service Worker ç¼“å­˜è¯¥ chunk                            â”‚
â”‚     â†“                                                       â”‚
â”‚  6. afterEach è§¦å‘ â†’ isLoading = false                     â”‚
â”‚     â†“                                                       â”‚
â”‚  7. éª¨æ¶å±æ¶ˆå¤±ï¼Œæ˜¾ç¤ºçœŸå®å†…å®¹                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äºŒæ¬¡è®¿é—®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       äºŒæ¬¡è®¿é—®æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. ç”¨æˆ·è®¿é—® /tasks                                         â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Service Worker æ‹¦æˆªè¯·æ±‚                                 â”‚
â”‚     â†“                                                       â”‚
â”‚  3. ç¼“å­˜å‘½ä¸­ â†’ ç›´æ¥è¿”å›ï¼ˆæ— ç½‘ç»œå»¶è¿Ÿï¼‰                        â”‚
â”‚     â†“                                                       â”‚
â”‚  4. é¡µé¢ç§’å¼€ï¼âš¡                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hover é¢„åŠ è½½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Hover é¢„åŠ è½½æµç¨‹                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. é¼ æ ‡æ‚¬åœåœ¨"ä»»åŠ¡"å¯¼èˆªä¸Š                                   â”‚
â”‚     â†“                                                       â”‚
â”‚  2. ç­‰å¾… 150msï¼ˆç¡®è®¤ä¸æ˜¯å¿«é€Ÿåˆ’è¿‡ï¼‰                           â”‚
â”‚     â†“                                                       â”‚
â”‚  3. requestIdleCallback ç©ºé—²æ—¶æ‰§è¡Œ                          â”‚
â”‚     â†“                                                       â”‚
â”‚  4. æ‰§è¡Œ import('./TaskManagementView.vue')                 â”‚
â”‚     â†“                                                       â”‚
â”‚  5. æµè§ˆå™¨ä¸‹è½½å¹¶ç¼“å­˜ chunk                                  â”‚
â”‚     â†“                                                       â”‚
â”‚  6. ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œchunk å·²åœ¨å†…å­˜ä¸­ â†’ ç§’åˆ‡ï¼                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¦‚ä½•æµ‹è¯•ä¼˜åŒ–æ•ˆæœ

### 1. æµ‹è¯•éª¨æ¶å±

1. æ‰“å¼€ Chrome DevTools â†’ Network
2. é€‰æ‹© **Slow 3G** ç½‘ç»œèŠ‚æµ
3. ç‚¹å‡»å¯¼èˆªåˆ‡æ¢é¡µé¢
4. è§‚å¯Ÿéª¨æ¶å±æ˜¯å¦ç«‹å³æ˜¾ç¤º

### 2. æµ‹è¯• Hover é¢„åŠ è½½

1. æ‰“å¼€ Chrome DevTools â†’ Console
2. æ‚¬åœåœ¨å¯¼èˆªå›¾æ ‡ä¸Š
3. è§‚å¯Ÿæ˜¯å¦å‡ºç° `ğŸ”® [Prefetch] é¢„åŠ è½½è·¯ç”±: /xxx`

### 3. æµ‹è¯• Service Worker

1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š`pnpm nx build web`
2. æœ¬åœ°é¢„è§ˆï¼š`pnpm nx preview web`
3. æ‰“å¼€ DevTools â†’ Application â†’ Service Workers
4. ç¡®è®¤ SW å·²æ³¨å†Œ
5. åˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿ Network ä¸­èµ„æºæ˜¯å¦æ¥è‡ª `(ServiceWorker)`

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆå¼€å‘ç¯å¢ƒçœ‹ä¸åˆ° Service Workerï¼Ÿ

**A:** æˆ‘ä»¬æ•…æ„åœ¨å¼€å‘ç¯å¢ƒç¦ç”¨äº† SWï¼Œå› ä¸ºï¼š
- ç¼“å­˜ä¼šå¯¼è‡´ä»£ç ä¿®æ”¹åçœ‹ä¸åˆ°å˜åŒ–
- HMRï¼ˆçƒ­æ›´æ–°ï¼‰ä¸ SW ç¼“å­˜å†²çª

### Q: éª¨æ¶å±ä¸€é—ªè€Œè¿‡æ€ä¹ˆåŠï¼Ÿ

**A:** è¿™æ˜¯æ­£å¸¸çš„ï¼è¯´æ˜é¡µé¢åŠ è½½å¾ˆå¿«ã€‚å¦‚æœæƒ³çœ‹åˆ°å®Œæ•´æ•ˆæœï¼Œå¯ä»¥ç”¨ DevTools æ¨¡æ‹Ÿæ…¢ç½‘ç»œã€‚

### Q: é¢„åŠ è½½ä¼šä¸ä¼šæµªè´¹æµé‡ï¼Ÿ

**A:** ä¸ä¼šå¤ªå¤šï¼Œå› ä¸ºï¼š
- åªé¢„åŠ è½½ç”¨æˆ·æ‚¬åœçš„é¡µé¢
- å·²åŠ è½½çš„é¡µé¢ä¸ä¼šé‡å¤åŠ è½½
- ä½¿ç”¨ `requestIdleCallback` ä¸é˜»å¡ä¸»çº¿ç¨‹

### Q: å¦‚ä½•æ¸…é™¤ Service Worker ç¼“å­˜ï¼Ÿ

**A:** ä¸¤ç§æ–¹å¼ï¼š
1. DevTools â†’ Application â†’ Storage â†’ Clear site data
2. ä»£ç ä¸­è°ƒç”¨ `clearAllCaches()` å‡½æ•°

---

## æ€»ç»“

| ä¼˜åŒ– | æ•ˆæœ | å®ç°å¤æ‚åº¦ |
|-----|------|-----------|
| è·¯ç”±éª¨æ¶å± | å³æ—¶åé¦ˆï¼Œæ¶ˆé™¤ç™½å± | â­â­ |
| Hover é¢„åŠ è½½ | é¢„æµ‹ç”¨æˆ·è¡Œä¸ºï¼Œæå‰åŠ è½½ | â­â­ |
| Service Worker | äºŒæ¬¡è®¿é—®ç§’å¼€ | â­â­â­ |

è¿™ä¸‰å±‚ä¼˜åŒ–ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥å¤§å¹…æå‡ç”¨æˆ·ä½“éªŒï¼Œè®© SPA åº”ç”¨æ„Ÿè§‰æ›´åŠ æµç•…ï¼

---

*æ–‡æ¡£ç¼–å†™ï¼šAmelia (Developer Agent)*
*æœ€åæ›´æ–°ï¼š2025-12-02*

