---
tags:
  - tech/lang/javascript
  - type/concept
  - status/growing
description: JavaScript内存管理与垃圾回收机制
created: 2025-01-01T00:00:00
updated: 2025-12-07T21:16:37
---

> [!info] **上级索引**
> [[ECMAScript MOC]]

---


# ESMAScript内存管理 

## 基础概念

### 回收机制

垃圾回收（Garbage Collection, GC）  
JavaScript 自动管理内存的核心机制，通过识别和释放不再使用的内存空间，防止内存泄漏并提升性能。  
可达性（Reachability）：从根对象（如全局变量、活动函数的局部变量等）出发，通过引用链无法访问的对象会被视为垃圾。

回收算法

- 标记-清除（Mark-and-Sweep）  
  原理：  
   标记阶段：从根对象出发，递归遍历所有可达对象并标记为活动。  
   清除阶段：遍历堆内存，释放未被标记的对象。  
  优点：  
   能处理循环引用问题  
  缺点：  
   可能产生内存碎片，清除时需要暂停程序。
- 引用计数（Reference Counting）  
  原理：  
   每个对象维护引用计数器，引用数量为 0 时回收。  
  优点：  
   可即时回收内存。  
  缺点：  
   无法解决循环引用问题。

#### 现代 JS 引擎的优化策略

1. 分代收集（Generational Collection）  
   分代假设：大多数对象生命周期短，少数长期存活。  
	新生代：存放短命对象，使用 复制算法（如 V8 的 Scavenge）快速回收。  
	老生代：存放长存对象，采用 标记-清除 + 标记-整理（减少碎片）。
2. 增量标记（Incremental Marking）  
   将标记过程拆分为多个小步骤，穿插在主线程任务中执行，减少程序停顿时间。
3. 闲时收集（Idle-Time Collection）  
   在 CPU 空闲时执行垃圾回收，减少对主线程性能的影响

### 内存管理

将内存占用量保持在一个较小的值可以让页面性能更好。  
优化内存占用的最佳手段就是保证在执行代码时只保存必要的数据。  
如果数据不再必要，那么把它设置为 null，从而释放其引用。这也可以叫作**解除引用**。

#### 怎么减少垃圾回收

数组  
在清空一个数组时，最简单的方法就是给其赋值为[ ]，但是与此同时会创建一个新的空对象，可以将数组的长度设置为0，以此来达到清空数组的目的。  

对象  
对于不再使用的对象，就将其设置为null，尽快被回收。  

函数  
在循环中的函数表达式，如果可以复用，尽量放在函数的外面。  

1. 使用 const 和 let  
   改进垃圾回收机制
2. 隐藏类和删除操作
3. 内存泄露
4. 静态分配与对象池  
   减少垃圾回收次数

## 内存泄漏

### 概念

内存泄露：由于错误或者疏忽程序没有释放已经不在使用的内存 无用的内存还在占用，得不到释放和归还，严重的时候无用的内存还在增加，导致整个系统的卡顿、奔溃  

内存溢出：当程序执行时需要的内存超过剩余内存的时候，会发生内存溢出  

### 内存泄漏发生的情况

以下四种情况会造成内存的泄漏：  
- 意外的全局变量： 由于使用未声明的变量，而意外的创建了一个全局变量，而使这个变量一直留在内存中无法被回收。
- 被遗忘的计时器或回调函数： 设置了 setInterval 定时器，而忘记取消它，那么这个变量会被一直留在内存中，而无法被回收。
- 脱离 DOM 的引用： 获取一个 DOM 元素的引用，而后面这个元素被删除，由于一直保留了对这个元素的引用，所以它也无法被回收。
- 闭包： 不合理的使用闭包，从而导致某些变量一直被留在内存当中。

## 参考信息

链接：https://juejin.cn/post/7120248211037487140

